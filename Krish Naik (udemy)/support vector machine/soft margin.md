# Soft Margin (SVC)

Soft Margin рж╣рж▓рзЛ SVM-ржПрж░ ржПржоржи ржПржХржЯрж┐ ржкржжрзНржзрждрж┐ ржпрзЗржЦрж╛ржирзЗ ржХрж┐ржЫрзБ ржбрзЗржЯрж╛ ржкрзЯрзЗржирзНржЯржХрзЗ margin ржнрж╛ржЩрждрзЗ ржмрж╛ ржнрзБрж▓ржнрж╛ржмрзЗ classify рж╣рждрзЗ рж╕рж╛ржорж╛ржирзНржп ржЕржирзБржорждрж┐ ржжрзЗржУрзЯрж╛ рж╣рзЯ, ржпрж╛рждрзЗ ржоржбрзЗрж▓ ржмрж╛рж╕рзНрждржм, noisy ржбрзЗржЯрж╛рзЯ ржмрзЗрж╢рж┐ ржнрж╛рж▓рзЛржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

---

## ржХрзЗржи Soft Margin ржжрж░ржХрж╛рж░?

- ржмрж╛рж╕рзНрждржм ржбрзЗржЯрж╛ ржкрзБрж░рзЛржкрзБрж░рж┐ ржкрж░рж┐рж╖рзНржХрж╛рж░ ржирзЯ (noise ржерж╛ржХрзЗ)
- ржХрж┐ржЫрзБ outlier ржерж╛ржХрзЗ
- рж╕ржм ржкрзЯрзЗржирзНржЯржХрзЗ рззрзжрзж% ржЖрж▓рж╛ржжрж╛ ржХрж░рж╛ ржпрж╛рзЯ ржирж╛

Hard Margin ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ:
- тЭМ ржоржбрзЗрж▓ ржЦрзБржм ржХрзЬрж╛ рж╣рзЯрзЗ ржпрж╛рзЯ
- тЭМ Overfitting-ржПрж░ ржЭрзБржБржХрж┐ ржмрж╛рзЬрзЗ

рж╕рзБрждрж░рж╛ржВ Soft Margin ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж┐ржЫрзБ ржнрзБрж▓ ржорзЗржирзЗ ржирж┐рзЯрзЗ overall рж╕рж┐ржжрзНржзрж╛ржирзНрждржХрзЗ ржнрж╛рж▓рзЛ рж░рж╛ржЦрж╛ рж╣рзЯред

---

## ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?

- ржХрж┐ржЫрзБ ржкрзЯрзЗржирзНржЯ margin-ржПрж░ ржнрзЗрждрж░рзЗ ржврзБржХрждрзЗ ржкрж╛рж░рзЗ
- ржХрж┐ржЫрзБ ржкрзЯрзЗржирзНржЯ ржнрзБрж▓ side-ржПржУ ржпрзЗрждрзЗ ржкрж╛рж░рзЗ
- ржПрж░ ржмрж┐ржирж┐ржорзЯрзЗ ржорж╛рж░рзНржЬрж┐ржи рждрзБрж▓ржирж╛ржорзВрж▓ржХ ржмрзЬ ржерж╛ржХрзЗ ржПржмржВ ржоржбрзЗрж▓ ржмрзЗрж╢рж┐ generalize ржХрж░рждрзЗ ржкрж╛рж░рзЗ

ржЧрж╛ржгрж┐рждрж┐ржХржнрж╛ржмрзЗ slack variable (\(\xi_i \ge 0\)) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯ, ржПржмржВ рж▓ржХрзНрж╖рзНржп рж╣рзЯ ржмрзЬ ржорж╛рж░рзНржЬрж┐ржи + ржХржо рждрзНрж░рзБржЯрж┐:

$$\min_{w,b,\xi} \; \frac{1}{2} \|w\|^2 + C \sum_i \xi_i \quad \text{s.t.}\quad y_i( w\cdot x_i + b ) \ge 1 - \xi_i,\; \xi_i \ge 0$$

ржПржЦрж╛ржирзЗ \(C\) рж╣рж▓рзЛ рждрзНрж░рзБржЯрж┐ (error)-ржПрж░ рж╢рж╛рж╕рзНрждрж┐/penaltyред

---

## C parameter (рж╕ржмржЪрзЗрзЯрзЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг)

- **C ржмрзЗрж╢рж┐**: ржнрзБрж▓ ржХржо рж╕рж╣рзНржп ржХрж░рзЗ, ржорж╛рж░рзНржЬрж┐ржи ржЫрзЛржЯ рж╣рждрзЗ ржкрж╛рж░рзЗ, Overfitting-ржПрж░ ржЭрзБржБржХрж┐
- **C ржХржо**: ржХрж┐ржЫрзБ ржнрзБрж▓ ржорзЗржирзЗ ржирзЗрзЯ, ржорж╛рж░рзНржЬрж┐ржи ржмрзЬ рж╣рзЯ, Generalization ржнрж╛рж▓рзЛ

ЁЯСЙ \(C\) ржорзВрж▓ржд error-ржПрж░ рж╢рж╛рж╕рзНрждрж┐ ржирж┐рзЯржирзНрждрзНрж░ржг ржХрж░рзЗ: \(C\) ржпржд ржмрзЬ, ржнрзБрж▓рзЗрж░ ржЦрж░ржЪ рждржд ржмрзЗрж╢рж┐ред

---

## Hard vs Soft Margin (рждрзБрж▓ржирж╛)

| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп | Hard Margin | Soft Margin |
|---|---|---|
| ржбрзЗржЯрж╛ separability | рж╕ржорзНржкрзВрж░рзНржг separable рж▓рж╛ржЧржмрзЗ | separable ржирж╛ рж╣рж▓рзЗржУ ржЪрж▓ржмрзЗ |
| Noise/Outlier | рж╕рж╣рзНржп ржХрж░рзЗ ржирж╛ | ржХрж┐ржЫрзБржЯрж╛ рж╕рж╣рзНржп ржХрж░рзЗ |
| Margin ржЖржХрж╛рж░ | рж╕рж╛ржзрж╛рж░ржгржд ржЫрзЛржЯ | рждрзБрж▓ржирж╛ржорзВрж▓ржХ ржмрзЬ |
| Generalization | ржжрзБрж░рзНржмрж▓ рж╣рждрзЗ ржкрж╛рж░рзЗ | рж╕рж╛ржзрж╛рж░ржгржд ржнрж╛рж▓рзЛ |
| Hyperparameter | ржирзЗржЗ (ржХрзНрж▓рж╛рж╕рж┐ржХрж╛рж▓) | `C` ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг |

---

## ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

ржпрзЗржоржи Spam Email Detection: ржХрж┐ржЫрзБ ржЗржорзЗржЗрж▓ ambiguous рж╣ржУрзЯрж╛рзЯ рж╕ржм ржЗржорзЗржЗрж▓ржХрзЗ рззрзжрзж% ржарж┐ржХ classify ржХрж░рж╛ ржХржарж┐ржиред Soft Margin ржмрж▓рзЗ: тАЬржХрж┐ржЫрзБ ржнрзБрж▓ ржЪрж▓ржмрзЗ, ржХрж┐ржирзНрждрзБ overall рж╕рж┐ржжрзНржзрж╛ржирзНрждржЯрж╛ ржнрж╛рж▓рзЛ рж╣рзЛржХредтАЭ

---

## Python ржбрзЗржорзЛ (C ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рж▓рзЗ ржХрзА рж╣рзЯ)

ржирзАржЪрзЗрж░ ржЙржжрж╛рж╣рж░ржгрзЗ `SVC(kernel="linear")` ржжрж┐рзЯрзЗ ржжрзБржЗржЯрж┐ ржЖрж▓рж╛ржжрж╛ `C` ржорж╛ржирзЗ рж╕рж┐ржжрзНржзрж╛ржирзНржд рж╕рзАржорж╛рж░рзЗржЦрж╛ ржжрзЗржЦрж╛ржирзЛ рж╣рзЯрзЗржЫрзЗред `C` ржмрзЬ рж╣рж▓рзЗ рж╕рзАржорж╛рж░рзЗржЦрж╛ ржнрзБрж▓ ржХржо рж╕рж╣рзНржп ржХрж░рзЗ (ржорж╛рж░рзНржЬрж┐ржи ржЫрзЛржЯ), `C` ржЫрзЛржЯ рж╣рж▓рзЗ рж╕рзАржорж╛рж░рзЗржЦрж╛ ржнрзБрж▓ ржмрзЗрж╢рж┐ рж╕рж╣рзНржп ржХрж░рзЗ (ржорж╛рж░рзНржЬрж┐ржи ржмрзЬ)ред

```python
import numpy as np
import matplotlib.pyplot as plt
from sklearn.datasets import make_blobs
from sklearn.svm import SVC

X, y = make_blobs(n_samples=120, centers=[(-2, -2), (2, 2)], cluster_std=1.5, random_state=7)

def plot_svm(C_value, ax):
	clf = SVC(kernel='linear', C=C_value)
	clf.fit(X, y)

	w = clf.coef_[0]
	b = clf.intercept_[0]

	x0_min, x0_max = X[:, 0].min() - 1, X[:, 0].max() + 1
	xx = np.linspace(x0_min, x0_max, 200)
	yy = -(w[0]/w[1]) * xx - b/w[1]
	yy_plus = -(w[0]/w[1]) * xx - (b + 1)/w[1]
	yy_minus = -(w[0]/w[1]) * xx - (b - 1)/w[1]

	ax.scatter(X[y==0, 0], X[y==0, 1], c='steelblue', edgecolor='k', label='ржХрзНрж▓рж╛рж╕ 0')
	ax.scatter(X[y==1, 0], X[y==1, 1], c='tomato', edgecolor='k', label='ржХрзНрж▓рж╛рж╕ 1')
	ax.plot(xx, yy, 'k-', lw=2, label='рж╕рж┐ржжрзНржзрж╛ржирзНржд рж╕рзАржорж╛рж░рзЗржЦрж╛')
	ax.plot(xx, yy_plus, 'k--', lw=1, label='ржорж╛рж░рзНржЬрж┐ржи +1')
	ax.plot(xx, yy_minus, 'k--', lw=1, label='ржорж╛рж░рзНржЬрж┐ржи -1')

	sv = clf.support_vectors_
	ax.scatter(sv[:, 0], sv[:, 1], s=120, facecolors='none', edgecolors='k', label='Support Vectors')
	ax.set_title(f'Linear SVM (C={C_value})')
	ax.legend(loc='upper left')

fig, axes = plt.subplots(1, 2, figsize=(12, 5))
plot_svm(C_value=0.1, ax=axes[0])
plot_svm(C_value=10.0, ax=axes[1])
plt.tight_layout()
plt.show()
```

> ржЯрж┐ржкрж╕: ржбрзЗржЯрж╛ ржпржжрж┐ рж▓рж┐ржирж┐рзЯрж╛рж░ржнрж╛ржмрзЗ separable ржирж╛ рж╣рзЯ, `kernel='rbf'` ржмрж╛ `kernel='poly'` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Soft Margin ржкрзНрж░рзЯрзЛржЧ ржХрж░рж╛ ржпрж╛рзЯ (SVC-рждрзЗ ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗржЗ Soft Margin ржерж╛ржХрзЗ)ред

---

## Quick Run (Windows)

ржкрзНрж░рзЯрзЛржЬржирзАрзЯ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирзНрж╕ржЯрж▓ ржХрж░рзЗ ржПржХржЯрж┐ `.py` ржлрж╛ржЗрж▓рзЗ ржХрзЛржбржЯрж┐ рж░рзЗржЦрзЗ рж░рж╛ржи ржХрж░рзБржи:

```powershell
pip install scikit-learn matplotlib numpy

# ржпржжрж┐ ржлрж╛ржЗрж▓рзЗрж░ ржирж╛ржо svc_soft_margin_demo.py рж╣рзЯ
python svc_soft_margin_demo.py
```

---

## ржПржХ рж▓рж╛ржЗржирзЗ рж╕ржВржХрзНрж╖рзЗржкрзЗ

ЁЯСЙ Soft Margin ржорж╛ржирзЗ margin ржмрзЬ рж░рж╛ржЦрж╛рж░ ржЬржирзНржп ржХрж┐ржЫрзБ classification error ржорзЗржирзЗ ржирзЗржУрзЯрж╛, ржпрж╛рждрзЗ ржоржбрзЗрж▓ ржмрж╛рж╕рзНрждржм ржбрзЗржЯрж╛рзЯ ржнрж╛рж▓рзЛржнрж╛ржмрзЗ generalize ржХрж░рждрзЗ ржкрж╛рж░рзЗред

